{% extends "base_dashboard.html" %}

{% block content %}
<div class="dash-wrapper">

    <!-- ── Page Header ── -->
    <div class="dash-header">
        <div class="dash-header-left">
            <div class="dash-icon">
                <i class="bi bi-building"></i>
            </div>
            <div>
                <h1 class="dash-title">Panel del Proveedor</h1>
                <p class="dash-subtitle">Gestiona tu documentación y mantenla al día</p>
            </div>
        </div>
        <a href="{% url 'supplier_document_add' %}" class="btn-upload">
            <i class="bi bi-cloud-upload-fill"></i>
            Cargar Documento
        </a>
    </div>

    <!-- ── Info Card ── -->
    <div class="info-card">
        <div class="info-card-header">
            <i class="bi bi-person-vcard-fill"></i>
            <span>Información de la Cuenta</span>
        </div>
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">Razón Social</span>
                <span class="info-value">{{ proveedor.nombre }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">NIT</span>
                <span class="info-value">{{ proveedor.nit }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Correo Electrónico</span>
                <span class="info-value">{{ proveedor.email }}</span>
            </div>
        </div>
    </div>

    <!-- ── Documents Table ── -->
    <div class="docs-card">
        <div class="docs-card-header">
            <div class="docs-title-wrap">
                <i class="bi bi-files"></i>
                <span>Documentos Cargados</span>
            </div>
        </div>
        <div class="table-wrap">
            <table class="docs-table">
                <thead>
                    <tr>
                        <th>Tipo de Documento</th>
                        <th>Fecha Carga</th>
                        <th>Vencimiento</th>
                        <th>Estado Admin</th>
                        <th>Estado Vigencia</th>
                        <th>Archivo</th>
                        <th>Comentarios</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc in documentos %}
                    <tr class="{% if not doc.es_valido %}row-invalid{% endif %}">
                        <td>
                            <span class="doc-name">{{ doc.tipo_documento.nombre }}</span>
                            {% if not doc.es_valido %}
                            <span class="badge-status badge-danger">❌ No válido</span>
                            {% else %}
                            <span class="badge-status badge-success">✔ Válido</span>
                            {% endif %}
                        </td>
                        <td class="text-secondary">{{ doc.fecha_carga|date:"d/m/Y H:i" }}</td>
                        <td>
                            {% if doc.fecha_vencimiento %}
                            <span class="date-chip">{{ doc.fecha_vencimiento|date:"d/m/Y" }}</span>
                            {% else %}
                            <span class="text-muted">N/A</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if doc.estado == 'aprobado' %}
                            <span class="badge-status badge-success">Aprobado</span>
                            {% elif doc.estado == 'rechazado' %}
                            <span class="badge-status badge-danger">Rechazado</span>
                            {% else %}
                            <span class="badge-status badge-warning">Pendiente</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if doc.esta_vencido %}
                            <span class="badge-status badge-danger">VENCIDO</span>
                            {% elif doc.fecha_vencimiento %}
                            <span class="badge-status badge-success">VIGENTE</span>
                            {% else %}
                            <span class="badge-status badge-secondary">Indefinido</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="action-group-premium" style="display: flex; gap: 8px;">
                                <button type="button" onclick="openPdfViewer('{% url 'serve_document_pdf' doc.pk %}')"
                                    class="btn-view" title="Visualizar">
                                    <i class="bi bi-eye"></i> <span class="ms-1">Ver</span>
                                </button>
                                <a href="{{ doc.archivo.url }}" download class="btn-action-premium"
                                    title="Descargar PDF">
                                    <i class="bi bi-download"></i> <span class="ms-1">Descargar</span>
                                </a>
                            </div>
                        </td>
                        <td class="comment-cell">
                            {% if doc.comentario %}
                            <span class="comment-text">{{ doc.comentario }}</span>
                            {% else %}
                            <span class="text-muted">—</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="empty-row">
                            <i class="bi bi-folder2-open"></i>
                            <p>No has cargado documentos aún.</p>
                            <a href="{% url 'supplier_document_add' %}" class="btn-upload-sm">Cargar primer
                                documento</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    /* ── Layout ── */
    .dash-wrapper {
        padding: 28px 0 48px;
        display: flex;
        flex-direction: column;
        gap: 22px;
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }

    /* ── Header ── */
    .dash-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 16px;
    }

    .dash-header-left {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .dash-icon {
        width: 52px;
        height: 52px;
        background: linear-gradient(135deg, #1a56db, #1e40af);
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #fff;
        box-shadow: 0 4px 14px rgba(26, 86, 219, 0.35);
        flex-shrink: 0;
    }

    .dash-title {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
        color: #0f172a;
        line-height: 1.2;
    }

    .dash-subtitle {
        margin: 0;
        font-size: 0.875rem;
        color: #64748b;
    }

    .btn-upload {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 11px 22px;
        background: linear-gradient(135deg, #1a56db, #1e40af);
        color: #fff !important;
        border-radius: 10px;
        font-size: 0.9rem;
        font-weight: 600;
        text-decoration: none !important;
        box-shadow: 0 4px 12px rgba(26, 86, 219, 0.35);
        transition: transform 0.15s, box-shadow 0.15s;
    }

    .btn-upload:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 18px rgba(26, 86, 219, 0.45);
        color: #fff !important;
    }

    /* ── Info Card ── */
    .info-card {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.07), 0 4px 16px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        border: 1px solid #f1f5f9;
    }

    .info-card-header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 14px 22px;
        background: linear-gradient(90deg, #f8faff, #eef2ff);
        border-bottom: 1px solid #e2e8f0;
        font-size: 0.875rem;
        font-weight: 700;
        color: #1e3a8a;
        letter-spacing: 0.3px;
    }

    .info-card-header i {
        font-size: 1rem;
        color: #1a56db;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        padding: 18px 22px;
        gap: 12px;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 3px;
    }

    .info-label {
        font-size: 0.73rem;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        color: #94a3b8;
        font-weight: 600;
    }

    .info-value {
        font-size: 0.95rem;
        color: #1e293b;
        font-weight: 500;
    }

    /* ── Documents Card ── */
    .docs-card {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.07), 0 4px 16px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        border: 1px solid #f1f5f9;
    }

    .docs-card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 22px;
        background: linear-gradient(90deg, #f8faff, #eef2ff);
        border-bottom: 1px solid #e2e8f0;
    }

    .docs-title-wrap {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.875rem;
        font-weight: 700;
        color: #1e3a8a;
    }

    .docs-title-wrap i {
        font-size: 1rem;
        color: #1a56db;
    }

    /* ── Table ── */
    .table-wrap {
        overflow-x: auto;
    }

    .docs-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem;
    }

    .docs-table thead tr {
        background: #f8fafc;
    }

    .docs-table th {
        padding: 12px 16px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.6px;
        color: #64748b;
        border-bottom: 1px solid #e2e8f0;
        white-space: nowrap;
    }

    .docs-table td {
        padding: 13px 16px;
        border-bottom: 1px solid #f1f5f9;
        color: #374151;
        vertical-align: middle;
    }

    .docs-table tbody tr:last-child td {
        border-bottom: none;
    }

    .docs-table tbody tr:hover td {
        background: #f8faff;
    }

    .row-invalid td {
        background: #fff5f5 !important;
    }

    .row-invalid:hover td {
        background: #fee2e2 !important;
    }

    .doc-name {
        display: block;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 4px;
    }

    .date-chip {
        display: inline-block;
        background: #f1f5f9;
        color: #475569;
        border-radius: 6px;
        padding: 2px 8px;
        font-size: 0.82rem;
    }

    /* ── Badges ── */
    .badge-status {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.2px;
    }

    .badge-success {
        background: #dcfce7;
        color: #15803d;
    }

    .badge-danger {
        background: #fee2e2;
        color: #dc2626;
    }

    .badge-warning {
        background: #fef9c3;
        color: #92400e;
    }

    .badge-secondary {
        background: #f1f5f9;
        color: #64748b;
    }

    .text-secondary {
        color: #64748b !important;
    }

    /* ── View Button ── */
    .btn-view {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 5px 12px;
        background: #eef2ff;
        color: #1a56db;
        border-radius: 7px;
        font-size: 0.82rem;
        font-weight: 600;
        text-decoration: none;
        transition: background 0.2s, color 0.2s;
        border: 1px solid #c7d7ff;
    }

    .btn-view:hover {
        background: #1a56db;
        color: #fff;
        text-decoration: none;
    }

    /* ── Comment ── */
    .comment-cell {
        max-width: 200px;
    }

    .comment-text {
        display: block;
        font-size: 0.8rem;
        color: #64748b;
        white-space: normal;
        line-height: 1.4;
    }

    /* ── Empty State ── */
    .empty-row {
        text-align: center;
        padding: 48px 20px !important;
        color: #94a3b8;
    }

    .empty-row i {
        font-size: 2.5rem;
        display: block;
        margin-bottom: 10px;
        color: #cbd5e1;
    }

    .empty-row p {
        margin-bottom: 14px;
        font-size: 0.95rem;
        color: #94a3b8;
    }

    .btn-upload-sm {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 18px;
        background: linear-gradient(135deg, #1a56db, #1e40af);
        color: #fff !important;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 600;
        text-decoration: none !important;
        transition: transform 0.15s, box-shadow 0.15s;
        box-shadow: 0 3px 10px rgba(26, 86, 219, 0.3);
    }

    .btn-upload-sm:hover {
        transform: translateY(-1px);
        color: #fff !important;
    }

    /* ── Responsive ── */
    @media (max-width: 768px) {
        .info-grid {
            grid-template-columns: 1fr;
        }

        .dash-header {
            flex-direction: column;
            align-items: flex-start;
        }
    }
</style>
{% endblock %}